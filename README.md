# 職務経歴書

## プロジェクト経験

### 中途転職・クチコミサービス

* **期間:** 2023年 / 2年以内
* **プロジェクトカテゴリ:** webサービス
* **担当工程:** 設計, コーディング, テスト, 運用/保守
* **経験した職種・役割:** バックエンド, フロントエンド
* **使用技術:** Ruby on Rails, Next.js, Nuxt.js, Docker, AWS, GitHub, Datadog, React, OpenAPI, Vue.js

#### プロジェクト概要
ユーザーが転職体験談や選考体験談や会社のクチコミを投稿し、閲覧できるサービスです。また、中途転職もできユーザーは求人に応募することができます。企業はユーザーにスカウトを送信することができます。

#### チーム情報
* PM: 1人
* バックエンドエンジニア: 1人
* フロントエンドエンジニア: 2人

#### プロジェクトにおける自身の役割
バックエンドを主に担当しており、3割ほどの時間でフロントエンドの開発も行っています。バックエンドでは、新機能のDBの設計やAPIの設計・開発・テスト、バージョンアップなど全般を基本1人で担当しています。フロントエンドでは、Nuxt2からNext.jsへのリプレイス、Nuxt2からNuxt3へのバージョンアップ、Next.jsでの新機能開発を担当しています。

#### 開発実績

##### 開発1・新規機能の開発
* **【概要】**
    既存のクチコミ投稿の項目変更などの大幅リニューアル
* **【どのような機能の開発・実装か】**
    DBの設計、APIの設計・実装・テストを担当しました。
* **【課題・問題点】**
    * 既存のクチコミと大幅に項目が変わったのでテーブル設計をどうするか。
    * カラムや項目の選択肢が大量に新しく追加されるので命名に時間がかかる。
* **【打ち手・使用した技術】**
    * 新しいクチコミ用のテーブルを追加し、新・旧両方のクチコミを検索・表示できるようにしました。
    * ChatGPTを活用し、カラム名や選択肢の変数名をかなり効率的に命名することができました。

##### 開発2・パフォーマンスチューニング
* **【概要】**
    レスポンスが遅いAPIがいくつかあり、ある日アクセスが集中してDBの負荷が上がりサイトがダウンしてしまうことがありました。
* **【どのような機能の開発・実装か】**
    APIが遅くなっている原因は主にクエリだったので、クエリのチューニングをしました。
* **【課題・問題点】**
    * N+1になっているクエリが複数あった。
    * IN句に大量のIDが指定されている。
* **【打ち手・使用した技術】**
    * Datadogを活用して、N+1になっている箇所やスロークエリーを発見し改善をしました。
    * サイトが落ちる原因になったAPIに関してはテーブルの設計を見直すことで、APIのレスポンスタイムを約1/10 (900ms → 90ms)に削減しました。
    * ローカルでテーブル設計の変更前と後のクエリのExplainを確認し、改善されることを確認してからテーブルの変更をしました。

##### 開発3・Nuxt2→Next.js、Nuxt2→Nuxt3
* **【概要】**
    複数のサービスがあり、そのうちの1つをNuxt2→Next.jsにリプレイス、もう1つをNuxt2→Nuxt3にバージョンアップしました。
* **【課題・問題点】**
    Nuxt2のコードは膨大な量あるため、一気に置き換えることは難しい。
* **【打ち手・使用した技術】**
    コンポーネント単位で少しずつReact化、CompositionAPI化をしていき、それが終わったらNext.jsとNuxt3のプロジェクトをそれぞれ作成しコンポーネントを移植していきました。

##### 開発4・Next.jsのデプロイ時間短縮
* **【概要】**
    Next.jsのデプロイが遅く、リリース頻度に影響があった。
* **【課題・問題点】**
    * Next.jsのDockerイメージが肥大化しており、Dockerイメージの生成とECRへのpushに時間がかかっていた。
    * 使用されていないキャッシュの生成にも時間がかかっていた。
* **【打ち手・使用した技術】**
    * Next.jsのStandaloneモードでビルドすることで、Dockerイメージのサイズが10分の1ほどになりDockerイメージ生成とECRへのpushが早くなった。
    * また、使用されていないキャッシュの生成処理を削除しました。
    * その結果Next.jsのデプロイ時間が40%削減され、デプロイ頻度が増加しました。

---

### 地方移住マッチングサービス

* **期間:** 2022年 / 2年以内
* **プロジェクトカテゴリ:** webサービス / 自社プロダクト
* **担当工程:** 設計, コーディング, テスト, 運用/保守
* **経験した職種・役割:** バックエンド, インフラ
* **使用技術:** Ruby on Rails, AWS, Vue.js, OpenSearch, Docker, CircleCI, Terraform, Fluentd, Amazon Aurora MySQL, Amazon ECS, Redis, RSpec

#### プロジェクト概要
地方に移住したい人と、地方に移住して来てほしい自治体をマッチングするサービスです。自治体の方が地域に関係するプロジェクトを作成し、地方に移住したい人が興味のあるプロジェクトに応募してマッチングさせるサービスです。

#### チーム情報 (開発部)
* PM: 2人
* デザイナー: 1人
* リードエンジニア(バックエンドエンジニア): 1人
* フロントエンドエンジニア: 2人
* バックエンドエンジニア: 1人 (私)
    * 私のポジションは一番下のバックエンドエンジニアです。
    * バックエンドの設計・実装は主に私が担当し、レビューはリードエンジニアの方にしていただきました。

#### 開発実績

##### 開発1・新規機能の開発
* **【概要】**
    主にRailsで地方の方が使うダッシュボードページの開発をしました。ダッシュボードページでは自分のアカウントの活動データなどをグラフや表にまとめたページです。その他、既存のバグ修正や機能の改善も行いました。
* **【どのような機能の開発・実装か】**
    下記のAPIの設計・開発・テストを担当しました。
    * プロジェクトが興味あるされた数やメッセージのやり取りをした人の数などあらゆるデータをグラフに表示するためのAPIの開発。
    * メッセージをやり取りした人の管理するページのAPIを開発。
* **【課題・問題点】**
    * 多様なデータを使用するため、APIの設計をどうするか。
    * APIのレスポンスが遅い問題が途中で発生した。
* **【打ち手・使用した技術】**
    * リソース毎にAPIを分けて、複数個所でAPIを使いまわせるように設計しました。
    * APIの設計にはOpenAPIを用い、フロントエンジニアとAPIの共有ができるようにしました。
    * APIのレスポンスが遅い問題は、どこの処理で遅くなっているかを調査しCarrierwaveのgemの部分が原因であることを特定し解消した。

##### 開発2・パフォーマンスチューニング
* **【概要】**
    DBのCPU使用率がたまに100%を超えるようになってきたので、RDSのインスタンスタイプを１つ上げて一時的に対応しました。その分コストがかかるようになったため、元のインスタンスタイプを元に戻せるようにCPUの負荷を下げるのが目的です。結果的に、CPU使用率を下げることに成功しインスタンスタイプを元に戻せました。この開発は1人で担当しました。
* **【どのような機能の開発・実装か】**
    Railsのコードの見直しやテーブルにインデックスを追加。
* **【課題・問題点】**
    * N+1やフルテーブルスキャンになっている箇所がいくつも存在していた。
    * レコード数が1億あるテーブルがあり、型を変更したり古いデータを削除する必要があったがレコード数が多すぎてALTER TABLEでDELETE文では実現できなかった。
* **【打ち手・使用した技術】**
    * 重たいページを中心にログを調査しN+1になっている箇所を見つけて解消しました。
    * slowqueryのログを見て、時間がかかっているクエリを調査し原因を特定しました。遅いクエリはフルテーブルスキャンになっていることが多かったため、適切なインデックスを張ったり使われいないインデックスを削除したりしました。
    * mysqlのexplainを見て確認しました。
    * IN句の中で大量のIDを指定しているクエリはフルテーブルスキャンになってしまう可能性があるのでサブクエリに変換しました。
    * COUNT文は省略できる場合があるので、省略できるところは省略しました。
    * レコード数が1億あるテーブルの型変更と古いデータ削除は、Aurora MySQLのBlue/Green Deployment機能を使いDBを入れ替えることで対応しました。

##### 開発3・OpenSearchの導入
* **【概要】**
    既存の全文検索処理をOpenSearchに移行する作業を1人で担当しました。元々OpenSearchは使われていなかったので1からやりました。
* **【どのような機能の開発・実装か】**
    プロジェクトを検索する機能を既存のRDBでやっていたのをOpenSearchに移行しました。プロジェクトを文字列、タグ、都道府県で検索できる機能です。OpenSearchに切り替えることで、APIのレスポンスタイムを半分にすることができました。
* **【課題・問題点】**
    * 課題としてはLIKEでの全文検索はデータ量が増加するにつれてパフォーマンスが悪くなっていくことでした。
    * OpenSearchを触ったことが無かったので、知識のインプットから始める必要があった。
    * ElascticSearchの記事はたくさんあるが、OpenSearchの記事が少ない。
    * OepSearchをRspecとCIでテストする記事が無かった。
    * 既存の全文検索とOpenSerarchを使った全文検索の検索結果が異なった。
* **【打ち手・使用した技術】**
    * OpenSearchの記事は少なかったので、ElasticSearchの記事を参考に実装した。
    * ローカル環境でDockerでOpenSearchを動かし、既存の検索機能を再現できることを検証した。
    * RspecとCircleCIでOpenSearchの検索のテストができるように設定をした。
    * Aliasを用いて今後indexを切り替えやすいようにした。
    * 全文検索の結果が異なる理由は、OpenSearchのトークナイザーによるものだったので、検索語ごとにトークン分割のされ方を調査しシノニムを設定することで解決した。

---

### VRコンテンツマネジメントシステム

* **期間:** 2019年 / 2年以上
* **プロジェクトカテゴリ:** webサービス / 自社プロダクト
* **担当工程:** 要件定義, 設計, コーディング, テスト, 運用/保守
* **経験した職種・役割:** バックエンド, フロントエンド, インフラ
* **使用技術:** Ruby on Rails, Vue.js, AWS, Docker

#### プロジェクト概要
自社のVR動画のコンテンツマネジメントシステムの新規開発。VRカメラで撮影した動画をアップロードし、管理するシステムです。管理した動画に対してメタ情報などを登録し、最終的にVRゴーグルが動画をダウンロードして視聴します。

#### チーム情報 (開発部)
* CTO: 1人
* ディレクター: 1人
* デザイナー: 1人
* フルスタックエンジニア: 2人 (私を含む)
* Unityエンジニア: 5人
    * 私のポジションはフルスタックエンジニアです。

#### 開発実績

##### 開発・VRコンテンツマネジメントシステムの開発
* **【概要】**
    VRコンテンツマネジメントシステムを初期から開発しました。RailsとVue.jsの両方を担当しました。
* **【どのような機能の開発・実装か】**
    ログイン機能、イベント開催機能、VRゴーグルの視点可視化機能、クレジットカード決済機能、VRデバイス管理機能、ユーザー管理機能、動画のタグ付け機能、レポート機能など。
* **【課題・問題点】**
    * VRゴーグルの視点可視化機能は動画の上に視点情報を描画してリアルタイムに表示する必要があった。
    * Vue.jsの表示が遅い問題があった。
* **【打ち手・使用した技術】**
    * VRゴーグルの視点可視化機能はcanvasとheatmap.jsを使用することで実現した。
    * Vue.jsのパフォーマンスはLighthouseを使用して問題点を発見し解消していった。
    * JSファイルをいくつかのチャンクに分割し、巨大なJSファイルをダウンロードしないようにした。
    * 顧客にデータのグラフを提供するときは、工数削減のためにAWSのQuickSightを使用した。
    * データの集計処理はAWSのLambdaを使用して負荷を分散した。

##### 開発・CI/CDの導入
* **【概要】**
    AWSのCodeシリーズを使って、GitLabにマージされたときにECSのFargateに自動でデプロイされるようにした。
* **【どのような機能の開発・実装か】**
    Code Pipeline, Code Commit, Code Build, Code Deployを使ってCI/CDを構築した。
* **【課題・問題点】**
    CI/CDの環境が無く知見が無かった。
* **【打ち手・使用した技術】**
    Codeシリーズについて書かれている技術書や記事を参考に試行錯誤して構築した。

---

### VRライブ配信システム

* **期間:** 2020年 / 2年以内
* **プロジェクトカテゴリ:** 自社プロダクト
* **担当工程:** 要件定義, 設計, コーディング, テスト, 運用/保守, その他
* **経験した職種・役割:** バックエンド, インフラ, ネットワーク
* **使用技術:** Ruby on Rails, Python, Nginx, FFmpeg, AWS, Docker, Deep Learning

#### プロジェクト概要
病院内にVRカメラとオンプレミスサーバーを設置してCMSとAPIで連携し、4Kライブ配信・録画・クラウドにアップロードをするシステムです。手術室にVRカメラを設置しライブ配信をすることで、別室でVRゴーグルを被って手術室の様子をリアルタイムに大人数で視聴することができます。ライブ配信した映像は録画されており、クラウドにアップロードされ後からダウンロードして見返すことができます。開発のリーダーとして、要求定義から検証、設計、開発、テスト、納品までの全てを主導しました。また、営業部や管理部などと密に連携を取ってプロジェクトを進めていました。

#### チーム情報
* リーダー兼フルスタックエンジニア: 1人 (私)
* Unityエンジニア: 1人
* 業務委託: 1人 (一時期間)
* 一部機能を外注
    * リーダー兼フルスタックエンジニアを担当しました。

#### 開発実績

##### 開発・VR配信システムの開発
* **【概要】**
    ローカル環境でVRカメラの映像を配信し、VRゴーグルで視聴できるようにする。また、ライブ配信の映像は録画しておき、AWSにアップロードする。
* **【どのような機能の開発・実装か】**
    * VRのライブ配信はFFmpegとnginxを用いた。
    * ライブ配信を開始したり、録画したりする機能はPythonを用いた。
    * 録画した映像に映っている人の顔をモザイク処理する機能はDeepLearningの物体検出と物体追跡を用いた。
* **【課題・問題点】**
    * VRライブ配信の多人数視聴時に映像がカクつく問題。
    * VRライブ配信は帯域を食うため、病院内のネットワークでやるために色々と突っ込まれる。
    * 病院ごとにオンプレサーバーを1台納品するので、セットアップが大変。
* **【打ち手・使用した技術】**
    * 映像がカクつく問題は、VR配信のビットレートを調整したりWiFiルーターの機種を変更したりして対応した。
    * 病院内のネットワーク問題は、各所で食う帯域を図にして病院に説明し調整した。
    * オンプレサーバーのセットアップはセットアップスクリプトやDockerを活用して、誰でも簡単に構築できるように工夫し外注できるようにした。
    * 一部機能を外注するにあたり外注先との仕様の打ち合わせや進捗・スケジュール管理をした。

---
